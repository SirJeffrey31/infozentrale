<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Info-Zentrale - Admin</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}body{font-family:'Segoe UI',sans-serif;background:#f5f5f5;min-height:100vh}.login-screen{display:flex;justify-content:center;align-items:center;min-height:100vh;background:linear-gradient(135deg,#1a1a2e,#16213e)}.login-box{background:#fff;padding:40px;border-radius:16px;text-align:center;max-width:400px;width:90%}.login-box h1{color:#1a1a2e;margin-bottom:10px}.login-box p{color:#666;margin-bottom:30px}.login-box input{width:100%;padding:15px;font-size:18px;border:2px solid #ddd;border-radius:8px;text-align:center;letter-spacing:8px;margin-bottom:20px}.login-box button{width:100%;padding:15px;background:#4ade80;color:#000;border:none;border-radius:8px;cursor:pointer;font-weight:600}.login-error{color:#ef4444;margin-top:15px;display:none}.admin-panel{display:none}.admin-header{background:linear-gradient(135deg,#1a1a2e,#16213e);color:#fff;padding:15px 30px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:15px}.admin-header h1{font-size:20px;color:#4ade80}.header-links{display:flex;gap:15px}.header-links a{color:#4ade80;text-decoration:none;padding:6px 12px;background:rgba(255,255,255,.1);border-radius:6px}.sync-status{display:flex;align-items:center;gap:10px}.sync-dot{width:10px;height:10px;border-radius:50%;background:#4ade80;animation:pulse 2s infinite}@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}.logout-btn{background:rgba(255,255,255,.1);color:#fff;border:1px solid rgba(255,255,255,.2);padding:8px 20px;border-radius:6px;cursor:pointer}.admin-content{padding:20px;max-width:1400px;margin:0 auto}.admin-tabs{display:flex;gap:10px;margin-bottom:20px;flex-wrap:wrap}.tab-btn{padding:12px 24px;border:none;background:#fff;border-radius:8px;cursor:pointer;font-weight:500}.tab-btn.active{background:#4ade80}.tab-content{display:none;background:#fff;border-radius:12px;padding:25px}.tab-content.active{display:block}.tab-content h2{margin-bottom:20px}.info-text{margin-bottom:15px;color:#666;font-size:14px}.touren-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:15px}.tour-edit-card{background:#f9f9f9;border-radius:10px;padding:15px;border:2px solid #e5e5e5}.tour-edit-card h3{margin-bottom:12px}.form-group{margin-bottom:12px}.form-group label{display:block;font-size:12px;color:#666;margin-bottom:5px}.form-group select,.form-group input,.form-group textarea{width:100%;padding:10px;border:1px solid #ddd;border-radius:6px}.status-buttons{display:grid;grid-template-columns:repeat(2,1fr);gap:6px}.status-btn{padding:10px;border:2px solid #ddd;border-radius:6px;cursor:pointer;font-size:11px;font-weight:600;background:#fff}.status-btn.kommissionieren.active{background:#ef4444;border-color:#ef4444;color:#fff}.status-btn.ready.active{background:#22c55e;border-color:#22c55e;color:#fff}.status-btn.unterwegs.active{background:#3b82f6;border-color:#3b82f6;color:#fff}.status-btn.erledigt.active{background:#6b7280;border-color:#6b7280;color:#fff}.rangliste-item{display:flex;align-items:center;gap:15px;padding:15px;background:#f9f9f9;border-radius:8px;margin-bottom:10px;border:2px solid #e5e5e5;flex-wrap:wrap}.rangliste-item.abwesend{opacity:.5;background:#fee2e2}.rangliste-item.has-kunde{border-color:#ef4444;background:#fef2f2}.rang-nummer{width:35px;height:35px;border-radius:50%;background:#ddd;display:flex;align-items:center;justify-content:center;font-weight:700}.rangliste-info{flex:1;min-width:120px}.rangliste-info strong{display:block}.rangliste-info .stat{font-size:12px;color:#666}.kunde-input{flex:2;min-width:180px}.kunde-input input{width:100%;padding:8px;border:1px solid #ddd;border-radius:6px}.rangliste-actions button{padding:8px 12px;border:1px solid #ddd;border-radius:6px;cursor:pointer;background:#fff}.rangliste-actions button.move-down{background:#4ade80;border-color:#4ade80}.checkbox-label{display:flex;align-items:center;gap:6px;font-size:12px;cursor:pointer}.checkbox-label input{width:16px;height:16px}.statistik-box{background:linear-gradient(135deg,#1a1a2e,#16213e);border-radius:12px;padding:20px;margin-bottom:20px;color:#fff}.statistik-box h3{color:#4ade80;margin-bottom:15px}.statistik-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:10px}.statistik-item{background:rgba(255,255,255,.1);padding:12px;border-radius:8px;text-align:center}.statistik-item .name{font-size:13px;font-weight:600;margin-bottom:5px}.statistik-item .count{font-size:24px;font-weight:700;color:#4ade80}.news-form{max-width:500px;margin-bottom:30px;padding:20px;background:#f9f9f9;border-radius:10px}.news-item{display:flex;align-items:center;gap:15px;padding:15px;background:#f9f9f9;border-radius:8px;border:2px solid #e5e5e5;margin-bottom:10px}.news-item .preview-img{width:80px;height:80px;border-radius:8px;object-fit:cover}.news-item .info{flex:1}.delete-btn{background:#ef4444;color:#fff;border:none;padding:8px 15px;border-radius:6px;cursor:pointer}.chauffeure-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:10px}.chauffeur-input{display:flex;align-items:center;gap:10px;padding:10px;background:#f9f9f9;border-radius:8px}.chauffeur-input span{min-width:30px;font-weight:600}.chauffeur-input input{flex:1;padding:8px;border:1px solid #ddd;border-radius:6px}.save-btn{background:#4ade80;color:#000;border:none;padding:12px 30px;border-radius:8px;font-weight:600;cursor:pointer;margin-top:20px}.reset-btn{background:#ef4444;color:#fff;border:none;padding:10px 20px;border-radius:8px;cursor:pointer;margin-left:10px}.success-msg{position:fixed;top:20px;right:20px;background:#4ade80;color:#000;padding:15px 25px;border-radius:8px;font-weight:600;display:none;z-index:1000}.image-upload-area{border:2px dashed #ddd;border-radius:8px;padding:20px;text-align:center;cursor:pointer}.image-upload-area.has-image{border-color:#4ade80}.image-upload-area input{display:none}.image-upload-area .preview{max-width:150px;border-radius:8px;margin-top:10px}
    </style>
</head>
<body>
    <div class="login-screen" id="loginScreen"><div class="login-box"><h1>ğŸ” Admin</h1><p>Gunterswiler Info-Zentrale</p><input type="password" id="pinInput" placeholder="PIN" maxlength="4"><button onclick="checkLogin()">Einloggen</button><p class="login-error" id="loginError">Falscher PIN!</p></div></div>
    <div class="admin-panel" id="adminPanel">
        <header class="admin-header"><h1>GUNTERSWILER <span style="color:#fff;font-weight:normal">Admin</span></h1><div class="header-links"><a href="index.html" target="_blank">ğŸ“º TV</a><a href="fahrer.html" target="_blank">ğŸ“± Fahrer</a></div><div class="sync-status"><span class="sync-dot"></span>Live</div><button class="logout-btn" onclick="logout()">Abmelden</button></header>
        <div class="admin-content">
            <div class="admin-tabs"><button class="tab-btn active" onclick="showTab('touren',this)">ğŸšš Touren</button><button class="tab-btn" onclick="showTab('rangliste',this)">ğŸ“‹ Nachlieferungen</button><button class="tab-btn" onclick="showTab('news',this)">ğŸ“¢ News</button><button class="tab-btn" onclick="showTab('chauffeure',this)">ğŸ‘¤ Chauffeure</button></div>
            <div class="tab-content active" id="tab-touren"><h2>Touren Status</h2><p class="info-text">Auto-Reset tÃ¤glich um 12:00</p><div class="touren-grid" id="tourenGrid"></div><button class="reset-btn" onclick="resetTouren()" style="margin-top:20px">ğŸ”„ Alle Kommissionieren</button></div>
            <div class="tab-content" id="tab-rangliste"><h2>Nachlieferungen</h2><div class="statistik-box"><h3>ğŸ“Š Statistik</h3><div class="statistik-grid" id="statistikGrid"></div><button class="reset-btn" onclick="resetStatistik()" style="margin-top:15px">ğŸ—‘ï¸ Statistik Reset</button></div><div id="ranglisteContainer"></div></div>
            <div class="tab-content" id="tab-news"><h2>News</h2><div class="news-form"><div class="form-group"><label>Bild (Pflicht)</label><div class="image-upload-area" id="imageUploadArea" onclick="document.getElementById('newsImage').click()"><input type="file" id="newsImage" accept="image/*" onchange="handleImageUpload(this)"><div id="uploadText">ğŸ“· Bild hochladen</div><img class="preview" id="imagePreview" style="display:none"></div></div><div class="form-group"><label>Titel</label><input type="text" id="newsTitel"></div><div class="form-group"><label>Text</label><textarea id="newsText" rows="2"></textarea></div><button class="save-btn" onclick="addNews()">â• HinzufÃ¼gen</button></div><div id="newsList"></div></div>
            <div class="tab-content" id="tab-chauffeure"><h2>Chauffeure (15)</h2><div class="chauffeure-grid" id="chauffeureGrid"></div><button class="save-btn" onclick="saveChauffeure()">ğŸ’¾ Speichern</button></div>
        </div>
    </div>
    <div class="success-msg" id="successMsg">âœ… Gespeichert!</div>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script>
        const firebaseConfig={apiKey:"AIzaSyAJIPZpX0ML_ahRqYGaysybxBHpbWKYspI",authDomain:"infozentrale-7b690.firebaseapp.com",projectId:"infozentrale-7b690",storageBucket:"infozentrale-7b690.firebasestorage.app",messagingSenderId:"634159156585",appId:"1:634159156585:web:deb48910b3f42d4e5081f8"};
        firebase.initializeApp(firebaseConfig);const db=firebase.firestore();
        const ADMIN_PIN='1951',TOUR_NAMEN=["Aadorf","Uster","Weinfelden","Winterthur","Schaffhausen","Frauenfeld FrÃ¼h","Test","Nahe Umgebung","Klettgau","Stein am Rhein","Frauenfeld SpÃ¤t"],MAX_CHAUFFEURE=15;
        let touren=[],rangliste=[],news=[],chauffeure=[],statistik={},uploadedImageBase64='';
        function checkLogin(){if(document.getElementById('pinInput').value===ADMIN_PIN){document.getElementById('loginScreen').style.display='none';document.getElementById('adminPanel').style.display='block';initializeData();}else{document.getElementById('loginError').style.display='block';document.getElementById('pinInput').value='';}}
        function logout(){document.getElementById('loginScreen').style.display='flex';document.getElementById('adminPanel').style.display='none';}
        document.getElementById('pinInput').addEventListener('keypress',e=>{if(e.key==='Enter')checkLogin();});
        function showTab(t,btn){document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));btn.classList.add('active');document.getElementById('tab-'+t).classList.add('active');}
        async function initializeData(){let d=await db.collection('settings').doc('chauffeure').get();chauffeure=d.exists?d.data().list:Array.from({length:MAX_CHAUFFEURE},(_,i)=>({name:i<12?'Chauffeur '+(i+1):'',excluded:false}));if(typeof chauffeure[0]==='string')chauffeure=chauffeure.map(c=>({name:c,excluded:false}));while(chauffeure.length<MAX_CHAUFFEURE)chauffeure.push({name:'',excluded:false});d=await db.collection('settings').doc('touren').get();touren=d.exists?d.data().list:TOUR_NAMEN.map((n,i)=>({name:n,fahrer:chauffeure[i]?.name||'',status:'kommissionieren'}));d=await db.collection('settings').doc('rangliste').get();rangliste=d.exists?d.data().list:chauffeure.filter(c=>c.name&&!c.excluded).map(c=>({fahrer:c.name,abwesend:false,kunde:'',excluded:false}));d=await db.collection('settings').doc('news').get();news=d.exists?d.data().list||[]:[];d=await db.collection('settings').doc('statistik').get();statistik=d.exists?d.data():{};renderAll();}
        function renderAll(){renderTouren();renderRangliste();renderStatistik();renderNews();renderChauffeure();}
        function renderTouren(){document.getElementById('tourenGrid').innerHTML=touren.map((t,i)=>`<div class="tour-edit-card"><h3>${t.name}</h3><div class="form-group"><label>Chauffeur</label><select onchange="updateTourFahrer(${i},this.value)"><option value="">--</option>${chauffeure.filter(c=>c.name).map(c=>`<option value="${c.name}"${t.fahrer===c.name?' selected':''}>${c.name}</option>`).join('')}</select></div><div class="form-group"><label>Status</label><div class="status-buttons"><button class="status-btn kommissionieren${t.status==='kommissionieren'?' active':''}" onclick="updateTourStatus(${i},'kommissionieren')">ğŸ”´ Komm.</button><button class="status-btn ready${t.status==='ready'?' active':''}" onclick="updateTourStatus(${i},'ready')">ğŸŸ¢ Ready</button><button class="status-btn unterwegs${t.status==='unterwegs'?' active':''}" onclick="updateTourStatus(${i},'unterwegs')">ğŸ”µ Untw.</button><button class="status-btn erledigt${t.status==='erledigt'?' active':''}" onclick="updateTourStatus(${i},'erledigt')">âœ… Erled.</button></div></div></div>`).join('');}
        function renderRangliste(){let p=0;document.getElementById('ranglisteContainer').innerHTML=rangliste.map((r,i)=>{if(r.excluded)return'';p++;return`<div class="rangliste-item${r.kunde?' has-kunde':''}${r.abwesend?' abwesend':''}"><span class="rang-nummer">${p}</span><div class="rangliste-info"><strong>${r.fahrer}</strong><span class="stat">ğŸ“Š ${statistik[r.fahrer]||0} NL</span></div><div class="kunde-input"><input placeholder="Kunde..." value="${r.kunde||''}" onchange="updateKunde(${i},this.value)"></div><div class="rangliste-actions"><button class="move-down" onclick="moveToBottom(${i})">â¬‡ï¸ Unten</button></div><label class="checkbox-label" style="margin-top:8px;width:100%"><input type="checkbox"${r.abwesend?' checked':''} onchange="toggleAbwesend(${i})">ğŸ  Abwesend</label></div>`;}).join('');}
        function renderStatistik(){document.getElementById('statistikGrid').innerHTML=rangliste.filter(r=>!r.excluded).map(r=>`<div class="statistik-item"><div class="name">${r.fahrer}</div><div class="count">${statistik[r.fahrer]||0}</div></div>`).join('');}
        function renderNews(){document.getElementById('newsList').innerHTML=news.length===0?'<p style="color:#666">Keine News</p>':news.map((n,i)=>`<div class="news-item">${n.bild?`<img class="preview-img" src="${n.bild}">`:'<div style="width:80px;height:80px;background:#eee;border-radius:8px"></div>'}<div class="info"><strong>${n.titel}</strong><br><small>${n.text}</small></div><button class="delete-btn" onclick="deleteNews(${i})">ğŸ—‘ï¸</button></div>`).join('');}
        function renderChauffeure(){document.getElementById('chauffeureGrid').innerHTML=chauffeure.map((c,i)=>`<div class="chauffeur-input"><span>${i+1}.</span><input value="${c.name}" onchange="updateChauffeurName(${i},this.value)" placeholder="Name..."><label class="checkbox-label"><input type="checkbox"${c.excluded?' checked':''} onchange="updateChauffeurExcluded(${i},this.checked)">Keine NL</label></div>`).join('');}
        function handleImageUpload(input){const file=input.files[0];if(file){compressImage(file,400,0.8).then(b=>{uploadedImageBase64=b;document.getElementById('imagePreview').src=b;document.getElementById('imagePreview').style.display='block';document.getElementById('imageUploadArea').classList.add('has-image');document.getElementById('uploadText').textContent='âœ… Geladen';});}}
        function compressImage(file,maxSize,quality){return new Promise((resolve)=>{const reader=new FileReader();reader.onload=e=>{const img=new Image();img.onload=()=>{const canvas=document.createElement('canvas');let w=img.width,h=img.height;if(w>h){if(w>maxSize){h=Math.round(h*maxSize/w);w=maxSize;}}else{if(h>maxSize){w=Math.round(w*maxSize/h);h=maxSize;}}canvas.width=w;canvas.height=h;canvas.getContext('2d').drawImage(img,0,0,w,h);resolve(canvas.toDataURL('image/jpeg',quality));};img.src=e.target.result;};reader.readAsDataURL(file);});}
        async function updateTourFahrer(i,v){touren[i].fahrer=v;await saveTouren();renderTouren();}
        async function updateTourStatus(i,s){touren[i].status=s;await saveTouren();renderTouren();}
        async function saveTouren(){await db.collection('settings').doc('touren').set({list:touren});showSuccess();}
        async function resetTouren(){if(confirm('Alle auf Kommissionieren?')){touren.forEach(t=>t.status='kommissionieren');await saveTouren();renderTouren();}}
        async function updateKunde(i,v){rangliste[i].kunde=v;await saveRangliste();}
        async function toggleAbwesend(i){rangliste[i].abwesend=!rangliste[i].abwesend;await saveRangliste();renderRangliste();}
        async function moveToBottom(i){const item=rangliste.splice(i,1)[0];statistik[item.fahrer]=(statistik[item.fahrer]||0)+1;item.kunde='';rangliste.push(item);await saveRangliste();await db.collection('settings').doc('statistik').set(statistik);renderRangliste();renderStatistik();}
        async function saveRangliste(){await db.collection('settings').doc('rangliste').set({list:rangliste});showSuccess();}
        async function resetStatistik(){if(confirm('Statistik zurÃ¼cksetzen?')){statistik={};await db.collection('settings').doc('statistik').set(statistik);renderStatistik();renderRangliste();showSuccess();}}
        async function addNews(){const titel=document.getElementById('newsTitel').value,text=document.getElementById('newsText').value;if(!uploadedImageBase64){alert('Bitte Bild hochladen!');return;}if(!titel||!text){alert('Titel und Text eingeben!');return;}news.unshift({titel,text,bild:uploadedImageBase64});await db.collection('settings').doc('news').set({list:news});document.getElementById('newsTitel').value='';document.getElementById('newsText').value='';document.getElementById('imagePreview').style.display='none';document.getElementById('imageUploadArea').classList.remove('has-image');document.getElementById('uploadText').textContent='ğŸ“· Bild hochladen';uploadedImageBase64='';renderNews();showSuccess();}
        async function deleteNews(i){if(confirm('LÃ¶schen?')){news.splice(i,1);await db.collection('settings').doc('news').set({list:news});renderNews();showSuccess();}}
        function updateChauffeurName(i,v){chauffeure[i].name=v;}
        function updateChauffeurExcluded(i,c){chauffeure[i].excluded=c;}
        async function saveChauffeure(){await db.collection('settings').doc('chauffeure').set({list:chauffeure});const active=chauffeure.filter(c=>c.name&&!c.excluded);rangliste=active.map(c=>{const ex=rangliste.find(r=>r.fahrer===c.name);return ex||{fahrer:c.name,abwesend:false,kunde:'',excluded:false};});await db.collection('settings').doc('rangliste').set({list:rangliste});renderAll();showSuccess();}
        function showSuccess(){const m=document.getElementById('successMsg');m.style.display='block';setTimeout(()=>m.style.display='none',2000);}
    </script>
</body>
</html>
